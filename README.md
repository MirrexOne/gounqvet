# sqlvet

`sqlvet` - это статический анализатор (линтер) для Go, предназначенный для поиска SQL-запросов с `SELECT *` в вашем коде. Использование `SELECT *` считается плохой практикой, так как это может привести к непредвиденному поведению при изменении схемы базы данных, а также к избыточной выборке данных.

Линтер обнаруживает `SELECT *` в:
- Строковых литералах.
- Методах популярных SQL-билдеров (например, `Columns("*")`).

`sqlvet` разработан для бесшовной интеграции с [golangci-lint](https://golangci-lint.run/).

## Установка и интеграция

### Интеграция с `golangci-lint`

`golangci-lint` автоматически скачает и интегрирует `sqlvet`, если вы добавите его в конфигурационный файл `.golangci.yml`.

1.  **Добавьте `sqlvet` в конфигурацию `.golangci.yml`:**

    ```yaml
    linters-settings:
      custom:
        sqlvet:
          # Замените на ваш путь к репозиторию
          path: github.com/your-username/sqlvet
          description: "Finds 'SELECT *' in raw strings and SQL builders"
          original-url: github.com/your-username/sqlvet

    linters:
      enable:
        - sqlvet
        # ... другие ваши линтеры
    ```

2.  **Запустите `golangci-lint`:**

    ```bash
    golangci-lint run
    ```

    `golangci-lint` сам позаботится о загрузке и компиляции линтера.

### Директива `nolint`

Вы можете игнорировать срабатывания линтера для конкретной строки с помощью стандартного комментария `nolint`:

```go
// Иногда это действительно необходимо
query := "SELECT * FROM temporary_table" //nolint:sqlvet
```

`golangci-lint` обрабатывает эти комментарии автоматически, никакой дополнительной настройки не требуется.

## Конфигурация

Линтер работает "из коробки" с разумными настройками по умолчанию. При необходимости вы можете настроить его в файле `.golangci.yml`.

```yaml
linters-settings:
  sqlvet:
    # (Опционально) Включить/выключить проверку SQL-билдеров. По умолчанию: true.
    check-sql-builders: true
    
    # (Опционально) Директории для игнорирования.
    ignore-dirs:
      - "vendor"
      - "generated"

    # (Опционально) Шаблоны имен файлов для игнорирования (регулярные выражения).
    ignore-file-patterns:
      - "_test.go$"
      - "\\.pb\\.go$"

    # (Опционально) Имена функций, которые нужно игнорировать.
    ignore-functions:
      - "SpecialQueryFunc"

    # (Опционально) Паттерны имен функций для игнорирования (регулярные выражения).
    ignore-function-regex:
      - "^New.*Query$"

    # (Опционально) Паттерны, которые считаются безопасными (регулярные выражения).
    # По умолчанию `count(*)` уже разрешен.
    allowed-patterns:
      - "count\\(\\*\\)"
      - "EXISTS\\(SELECT \\* FROM"
```

## Как это работает?

`sqlvet` использует пакет `go/analysis` для синтаксического разбора вашего Go-кода. Он обходит AST (Abstract Syntax Tree) и ищет два типа узлов:

1.  **`ast.BasicLit`**: Проверяет строковые литералы на содержание `select *`.
2.  **`ast.CallExpr`**: Анализирует вызовы функций. Если имя функции совпадает с популярными именами методов SQL-билдеров (`Select`, `Columns`, `Column`) и один из аргументов является строкой `*`, линтер сообщает об ошибке.

Такой подход позволяет линтеру быть независимым от конкретных реализаций SQL-билдеров и избегать ложных срабатываний.